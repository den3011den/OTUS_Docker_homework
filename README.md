## Описание сервиса Catalog
Сервис Catalog является частью системы Library - библиотека учебного заведения. 

**Назначение сервиса:**
* Ведение справочников системы - авторы (Authors), издатели (Publishers), книги (Books), экземпляры книг (BookInstances), статусы состояний экземпляров книг (States)
* Связка сущностей между собой - Книги-Авторы, Книги-издатели, Книги-Экземпляры книг, Экземпляры книг-Статусы состояний экземпляров книг
* Хранение информации об экземпляре книги - выдан читателю/находится в библиотеке, забронирован/не забронирован, дата выдачи, списан/не списан, причина списания, статус состояния экземпляра, комментарий текущего статуса состояния
* Обеспечение других сервисов информацией из справочников

**Для ролей Администратор и Библиотекарь доступен весь функционал сервиса:**
* Справочник Авторы (Authors) - Просмотр/Поиск/Добавление/редактирование/удаление в архив/восстановление из архива 
* Справочник Издатели (Publishers) - Просмотр/Поиск/Добавление/редактирование/удаление в архив/восстановление из архива 
* Справочник Статусы (States) - Просмотр/Поиск/Добавление/редактирование/удаление в архив/восстановление из архива 
* Справочник Книги (Books) - Просмотр/Поиск/Добавление/редактирование/удаление в архив/восстановление из архива 
* Справочник Экземпляры книг (BookInstances) - Просмотр/Поиск/Добавление/редактирование/удаление в архив/восстановление из архива

**Для ролей Незарегистрированный пользователь, Зарегистрированный не подтверждённый пользователь и Зарегистрированный подтверждённый пользователь доступно:**
* Просмотр списка книг
* Поиск по списку книг

**Межсервисное взаимодействие**

**Другим сервисам предоставляется информация:**
* Список авторов и поиск конкретного по ИД, наименованию
* Список издателей и поиск конкретного по ИД, наименованию
* Список статусов и поиск конкретного по ИД, наименованию
* Список Книг и поиск конкретной по ИД, наименованию
* Список Экземпляров книг и поиск конкретного по ИД, наименованию

**Сервису Фактов выдачи и возврата книг (Facts) предоставляются посредством вызова API следующие следующие функции:**
* Установить отметку о выдаче экземпляра книги читателю и дату выдачи
* Снять отметку о выдаче экземпляра книги читателю и очистка даты выдачи
* Установить экземпляру книги статус его состояния после возврата читателем
* Установить экземпляру комментарий его состояния после возврата
* Увеличить счётчик скачивания электронной версии книги

**Сервису "Приход и списание книг" предоставляются посредством вызова API следующие функции:**
* Установить дату и причину списания экземпляра книги
* Удалить дату и причину списания экземпляра книги
* Добавить новый экземпляр книги

**Сервису Бронирование книг предоставляются посредством вызова API следующие функции:**
* Установить отметку о бронировании экземпляра читателем
* Снять отметку о бронировании экземпляра читателем

**Сервис "Аутентификация, авторизация и регистрация" предоставляет для данного сервиса информацию о пользователе сервиса:**
* Информация о текущем пользователе сервиса - ИД, роль, признак удаления в архив и тп



## Диаграмма вариантов использования сервиса Catalog

[![Диаграмма вариантов использования сервиса Catalog](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/UseCases%20сервиса%20Catalog.drawio.png)](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/UseCases%20сервиса%20Catalog.drawio.png)
[Ссылка на картинку](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/UseCases%20сервиса%20Catalog.drawio.png)

[Ссылка на исходник схемы](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/UseCases%20сервиса%20Catalog.drawio)


## БД сервиса Calalog

### ER-диаграмма
[![ER-диаграмма БД сервиса Catalog](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/БД%20сервиса%20Calalog.drawio.png)](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/БД%20сервиса%20Calalog.drawio.png)
[Ссылка на картинку](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/БД%20сервиса%20Calalog.drawio.png)

[Ссылка на исходник схемы](https://github.com/den3011den/Library/blob/main/Docs/Services/Calalog/БД%20сервиса%20Calalog.drawio)

### Табличное описание

##### Authors - справочник авторов книг

| Ключ                    | Наименование   | тип              | Описание                            | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | -------------- | ---------------- | ----------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**         | int              | Ид записи                           |                         | not null, autoincrement                                             |
|                         | **Firstname**  | nvarchar(100)    | Имя автора                          |                         | not null                                                            |
|                         | **Lastname**   | nvarchar(100)    | Фамилия автора                      |                         | not null                                                            |
|                         | **Middlename** | nvarchar(100)    | Отчество автора                     |                         |                                                                     |
|                         | **IsForiegn**  | bit              | Признак иностранного автора         |                         |                                                                     |
|                         | **AddUserId**  | uniqueidentifier | Ид пользователя, добавившего запись | <center>**FK**</center> | not null, Связь по полю Users.Id (Сервис Авторизации и регистрации) |
|                         | **AddTime**    | datetime         | Дата/время добавления записи        |                         | not null                                                            |
|                         | **IsArchive**  | bit              | Признак удаления записи в архив     |                         |                                                                     |

##### Publishers - справочник издательств

| Ключ                    | Наименование  | тип              | Описание                            | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | ------------- | ---------------- | ----------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**        | int              | Ид записи                           |                         | not null, autoincrement                                             |
|                         | **Name**      | nvarchar(100)    | Наименование                        |                         | not null                                                            |
|                         | **AddUserId** | uniqueidentifier | Ид пользователя, добавившего запись | <center>**FK**</center> | not null, Связь по полю Users.Id (Сервис Авторизации и регистрации) |
|                         | **AddTime**   | datetime         | Дата/время добавления записи        |                         | not null                                                            |
|                         | **IsArchive** | bit              | Признак удаления записи в архив     |                         |                                                                     |


##### Books - справочник книг

| Ключ                    | Наименование           | тип              | Описание                                   | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | ---------------------- | ---------------- | ------------------------------------------ | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**                 | int              | Ид записи                                  |                         | not null, autoincrement                                             |
|                         | **Name**               | nvarchar(100)    | Наименование                               |                         | not null                                                            |
|                         | **ISBN**               | nvarchar(12)     | ISBN-номер                                 |                         | not null                                                            |
|                         | **PublisherId**        | int              | ИД издательства                            | <center>**FK**</center> | not null, Связь по полю Publisher.Id                                |
|                         | **PublishDate**        | datetime         | Дата публикации                            |                         | not null                                                            |
|                         | **EbookLink**          | nvarchar(300)    | Адрес расположения электронной копии книги |                         |                                                                     |
|                         | **EbookDownloadCount** | int              | Кол-во скачиваний электронной копии книги  |                         |                                                                     |
|                         | **AddUserId**          | uniqueidentifier | Ид пользователя, добавившего запись        | <center>**FK**</center> | not null, Связь по полю Users.Id (Сервис Авторизации и регистрации) |
|                         | **AddTime**            | datetime         | Дата/время добавления записи               |                         | not null                                                            |
|                         | **IsArchive**          | bit              | Признак удаления записи в архив            |                         |                                                                     |



##### BooksToAuthors - связь авторов с книгами

| Ключ                    | Наименование  | тип              | Описание                            | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | ------------- | ---------------- | ----------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**        | int              | Ид записи                           |                         | not null, autoincrement                                             |
|                         | **BookId**    | Int              | ИД книги                            | <center>**FK**</center> | not null, Связь по полю Books.Id                                    |
|                         | **AuthorId**  | int              | ИД автора                           | <center>**FK**</center> | not null, Связь по полю Authors.Id                                  |
|                         | **AddUserId** | uniqueidentifier | Ид пользователя, добавившего запись | <center>**FK**</center> | not null, Связь по полю Users.Id (Сервис Авторизации и регистрации) |
|                         | **AddTime**   | datetime         | Дата/время добавления записи        |                         | not null                                                            |

##### BookInstances - справочник экземпляров книг

| Ключ                    | Наименование           | тип              | Описание                                                      | внеш. ключ              | Доп инфо                                                            |
| ----------------------- | ---------------------- | ---------------- | ------------------------------------------------------------- | ----------------------- | ------------------------------------------------------------------- |
| <center>**PK**</center> | **Id**                 | int              | Ид записи                                                     |                         | not null, autoincrement                                             |
|                         | **BookId**             | Int              | ИД книги                                                      | <center>**FK**</center> | not null, Связь по полю Books.Id                                    |
|                         | **InventoryNumber**    | nvarchar(16)     | Инвентарный номер                                             |                         | not null, unique                                                    |
|                         | **ReceiptDate**        | datetime         | Дата поступления в библиотеку                                 |                         | not null                                                            |
|                         | **WriteOffDate**       | datetime         | Дата списания                                                 |                         |                                                                     |
|                         | **IsCheckedOut**       | bit              | Признак, что экземпляр книги выдана читателю                  |                         |                                                                     |
|                         | **IsBooked**           | bit              | Признак, что экземпляр книги забронирован читателем           |                         |                                                                     |
|                         | **OnlyForReadingRoom** | bit              | Признак, что экземпляр выдаётся только в читальный зал        |                         |                                                                     |
|                         | **WriteOffReasonId**   | int              | Ид причины списания                                           | **<center>FK</center>** | Связь по полю WriteOffReasons.Id (Сервис Приход и списание книг)    |
|                         | **StateId**            | int              | Ид текущего состояния экземпляра                              | <center>**FK**</center> | not null, связь по полю States.Id                                   |
|                         | **FactCommentId**      | int              | Комментарий к текущему состоянию экземпляра                   | <center>**FK**</center> | Связь по полю FactComments.Id (Сервис фактов)                       |
|                         | **WriteOffUserId**     | uniqueidentifier | Ид пользователя, списавшего экземпляр                         | <center>**FK**</center> | Связь по полю Users.Id (Сервис Авторизации и регистрации)           |
|                         | **OutMaxDays**         | int              | макс. кол-во дней, на которые можно выдать экземпляр читателю |                         |                                                                     |
|                         | **AddUserId**          | uniqueidentifier | Ид пользователя, добавившего запись                           | <center>**FK**</center> | not null, Связь по полю Users.Id (Сервис Авторизации и регистрации) |
|                         | **AddTime**            | datetime         | Дата/время добавления записи                                  |                         | not null                                                            |


##### States - справочник состояний экземпляров книг

| Ключ                    | Наименование       | тип           | Описание                                                                                 | внеш. ключ | Доп инфо                |
| ----------------------- | ------------------ | ------------- | ---------------------------------------------------------------------------------------- | ---------- | ----------------------- |
| <center>**PK**</center> | **Id**             | int           | Ид записи                                                                                |            | not null, autoincrement |
|                         | **Name**           | nvarchar(50)  | Наименование                                                                             |            | not null                |
|                         | **Description**    | nvarchar(300) | Описание                                                                                 |            |                         |
|                         | **IsInitialState** | bit           | Состояние по умолчанию для новых книг                                                    |            |                         |
|                         | **NeedComment**    | bit           | признак, что сотояние нуждается в обязательном комментарии факту выдачи и возврате книги |            |                         |
|                         | **IsArchive**      | bit           | Признак удаления записи в архив                                                          |            |                         |

